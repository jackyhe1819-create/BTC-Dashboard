<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC 长期指标仪表盘</title>
    <meta name="description" content="实时监控比特币长期指标，包括 Pi Cycle Top、减半周期、Ahr999、幂律走廊等核心指标">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>₿</text></svg>">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=4">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>₿ BTC 长期指标仪表盘</h1>
            <p class="subtitle">基于 P0/P1 核心指标的市场监控系统</p>
            <p class="timestamp" id="timestamp">加载中...</p>
        </header>

        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text">正在获取 BTC 数据...</p>
        </div>

        <!-- Main Content (hidden until data loads) -->
        <main id="mainContent" style="display: none;">
            <!-- Top Summary Bar (Key Metrics) -->
            <section class="top-summary-bar" id="topSummaryBar">
                <div class="summary-item primary">
                    <span class="label">BTC 价格</span>
                    <span class="value" id="summaryPrice">--</span>
                    <span class="change neutral" id="summaryChange">--</span>
                </div>
                <div class="summary-item">
                    <span class="label">全网算力</span>
                    <span class="value" id="summaryHashrate">--</span>
                </div>
                <div class="summary-item">
                    <span class="label">Ahr999</span>
                    <span class="value" id="summaryAhr999">--</span>
                </div>
                <div class="summary-item">
                    <span class="label">恐惧贪婪</span>
                    <span class="value" id="summaryFearGreed">--</span>
                </div>
                <div class="summary-item">
                    <span class="label">减半倒计时</span>
                    <span class="value" id="summaryHalving">--</span>
                </div>
                <div class="summary-item">
                    <span class="label">均衡价格</span>
                    <span class="value" id="summaryBalanced">--</span>
                </div>
            </section>

            <!-- 价格走势图 (New in V4.0) -->
            <div class="chart-section"
                style="margin: 20px 0; background: var(--card-bg); border-radius: 12px; padding: 15px; border: 1px solid var(--border-color);">
                <div class="section-title" style="margin-bottom: 10px;">比特币价格走势 (BTC/USD · 多交易所综合)</div>
                <!-- TradingView Widget BEGIN -->
                <div class="tradingview-widget-container" style="height: 500px; width: 100%;">
                    <div id="tradingview_b1e2c" style="height: 100%; width: 100%;"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                    <script type="text/javascript">
                        new TradingView.widget(
                            {
                                "autosize": true,
                                "symbol": "INDEX:BTCUSD",
                                "interval": "D",
                                "timezone": "Etc/UTC",
                                "theme": "dark",
                                "style": "1",
                                "locale": "zh_CN",
                                "enable_publishing": false,
                                "allow_symbol_change": true,
                                "container_id": "tradingview_b1e2c"
                            }
                        );
                    </script>
                </div>
                <!-- TradingView Widget END -->
            </div>

            <!-- Score Gauge + Summary Table -->
            <section class="gauge-section">
                <div class="score-summary-container">
                    <!-- Left: Gauge -->
                    <div class="gauge-container">
                        <h2 class="gauge-title">综合评分</h2>
                        <div class="gauge">
                            <div class="gauge-bg"></div>
                            <div class="gauge-needle" id="gaugeNeedle"></div>
                            <div class="gauge-center"></div>
                        </div>
                        <div class="gauge-labels">
                            <span>-1 (卖出)</span>
                            <span>0</span>
                            <span>+1 (买入)</span>
                        </div>
                        <div class="score-value" id="scoreValue">--</div>
                        <div class="recommendation yellow" id="recommendation">加载中...</div>
                    </div>

                    <!-- Right: Summary Table -->
                    <div class="summary-table-container">
                        <h2 class="table-title">指标总览</h2>
                        <table class="summary-table" id="summaryTable">
                            <thead>
                                <tr>
                                    <th>指标</th>
                                    <th>数值</th>
                                    <th>结论</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
    </div>
    </section>


    <!-- 资讯信息模块 (Moved up) -->
    <section class="news-section" style="margin-top: 30px;">
        <h2 class="section-title">
            <span class="icon">📰</span>
            BTC 资讯中心
        </h2>
        <div class="news-layout" style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">

            <!-- Left Column: Calendars & Whale (Stacked) -->
            <div class="news-col-left"
                style="flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 20px; height: 780px;">

                <!-- 宏观经济日历 -->
                <div class="news-card"
                    style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); height: 380px; display: flex; flex-direction: column;">
                    <h3 style="color: #f79322; margin-bottom: 15px; font-size: 1.1rem; flex-shrink: 0;">
                        🏦 宏观经济日历
                        <span style="font-size: 0.8rem; color: #888; font-weight: normal; margin-left: 10px;">
                            CPI · 非农 · 利率决议
                        </span>
                    </h3>
                    <div id="macroCalendar" class="news-list" style="flex: 1; overflow-y: auto;">
                        <p style="color: #888;">加载中...</p>
                    </div>
                </div>

                <!-- 巨鲸动态 -->
                <div class="news-card"
                    style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); flex: 1; min-height: 0; display: flex; flex-direction: column;">
                    <h3 style="color: #f79322; margin-bottom: 15px; font-size: 1.1rem; flex-shrink: 0;">
                        🐋 巨鲸动态
                        <span
                            style="font-size: 0.75rem; color: #888; font-weight: normal; display: block; margin-top: 3px;">Blockchain.com
                            实时大额交易</span>
                    </h3>
                    <div id="whaleActivity" class="news-list" style="flex: 1; overflow-y: auto; padding-right: 8px;">
                        <p style="color: #888;">加载中...</p>
                    </div>
                </div>

            </div>

            <!-- Right Column: BTC News Aggregation (Fixed 580px Height) -->
            <div class="news-col-right" style="flex: 2; min-width: 300px;">
                <div class="news-card"
                    style="background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); height: 780px; display: flex; flex-direction: column;">
                    <h3 style="color: #f79322; margin-bottom: 15px; font-size: 1.1rem; flex-shrink: 0;">
                        📰 BTC 资讯聚合
                        <span style="font-size: 0.8rem; color: #888; font-weight: normal; margin-left: 10px;">
                            CoinDesk · CoinTelegraph · Bitcoin Magazine · NewsBTC · 律动
                        </span>
                    </h3>
                    <div id="cryptoNews" class="news-list" style="flex: 1; overflow-y: auto; padding-right: 10px;">
                        <p style="color: #888;">加载中...</p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- 长期指标 (周期/定投参考) -->
    <section class="indicators-section">
        <h2 class="section-title">
            <span class="icon">📊</span>
            长期指标 (周期/定投参考)
        </h2>
        <div class="indicators-grid" id="longTermIndicators">
            <!-- Dynamically populated -->
        </div>
    </section>

    <!-- 短期指标 (交易参考) -->
    <div class="priority-section">
        <div class="section-title">📈 短期指标 (交易参考)</div>
        <div class="cards-container" id="shortTermIndicators">
            <!-- 由 JS 动态填充 -->
        </div>
    </div>

    <!-- 辅助指标 -->
    <div class="priority-section">
        <div class="section-title">📋 辅助指标 (Optional)</div>
        <div class="cards-container" id="auxIndicators">
            <!-- 由 JS 动态填充 -->
        </div>
    </div>
    </main>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" id="refreshBtn" title="刷新数据">🔄</button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Global Tooltip Container (Nuclear Option to bypass clipping) -->
    <div id="global-tooltip" class="card-details-popover" style="position: fixed; z-index: 9999; display: none;"></div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>